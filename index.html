<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gun Violence Social Network Dashboard</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>
    <style>
        body {
            background: linear-gradient(135deg, #0a0e1a 0%, #1a1f35 100%);
            min-height: 100vh;
            padding: 24px;
            color: #e2e8f0;
            font-family: Arial, sans-serif;
            margin: 0;
        }
        h1 {
            font-size: 32px;
            font-weight: 700;
            margin-bottom: 8px;
            color: #60a5fa;
        }
        .subtitle {
            color: #94a3b8;
            margin-bottom: 24px;
        }
        .container {
            max-width: 1400px;
            margin: 0 auto;
        }
        .row {
            display: flex;
            gap: 20px;
            margin-bottom: 20px;
        }
        .col-2 {
            flex: 2;
        }
        .col-1 {
            flex: 1;
        }
        .card {
            background: #0f1421;
            border-radius: 12px;
            padding: 20px;
            border: 1px solid #1e3a5f;
        }
        .card-title {
            font-size: 18px;
            margin-bottom: 16px;
            color: #60a5fa;
        }
        #networkCanvas {
            width: 100%;
            height: auto;
            cursor: pointer;
            border-radius: 8px;
            display: block;
        }
        .canvas-note {
            font-size: 12px;
            color: #64748b;
            margin-top: 12px;
        }
        .stat-item {
            background: #1a1f35;
            padding: 12px;
            border-radius: 8px;
            border-left: 3px solid #3b82f6;
            margin-bottom: 12px;
        }
        .stat-label {
            font-size: 12px;
            color: #94a3b8;
            text-transform: uppercase;
        }
        .stat-value {
            font-size: 20px;
            font-weight: 600;
            color: #e2e8f0;
            margin-top: 4px;
        }
        .chart-container {
            position: relative;
            height: 300px;
        }
        .insight-box {
            margin-top: 16px;
            padding: 12px;
            background: #1a1f35;
            border-radius: 8px;
            font-size: 13px;
            color: #cbd5e1;
        }
        .insight-box strong {
            color: #60a5fa;
        }
        .summary-grid {
            display: flex;
            flex-wrap: wrap;
            gap: 16px;
        }
        .summary-item {
            background: #1a1f35;
            padding: 16px;
            border-radius: 8px;
            border-left: 3px solid #8b5cf6;
            flex: 1 1 calc(33.333% - 16px);
            min-width: 250px;
        }
        .summary-label {
            font-size: 13px;
            color: #94a3b8;
            margin-bottom: 8px;
        }
        .summary-value {
            font-size: 24px;
            font-weight: 600;
            color: #e2e8f0;
        }
        .node-details {
            margin-top: 16px;
            background: #1a1f35;
            border-radius: 8px;
            padding: 16px;
            border-left: 4px solid #f59e0b;
            display: none;
        }
        .node-details.active {
            display: block;
        }
        .node-details-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 16px;
        }
        .node-details-title {
            font-size: 18px;
            font-weight: 600;
            color: #f59e0b;
        }
        .close-btn {
            background: none;
            border: none;
            color: #94a3b8;
            font-size: 20px;
            cursor: pointer;
            padding: 0;
            width: 24px;
            height: 24px;
        }
        .close-btn:hover {
            color: #e2e8f0;
        }
        .details-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 12px;
        }
        .detail-item-label {
            font-size: 11px;
            color: #94a3b8;
            text-transform: uppercase;
            margin-bottom: 4px;
        }
        .detail-item-value {
            font-size: 14px;
            color: #e2e8f0;
            font-weight: 500;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Gun Violence Social Network Analysis</h1>
        <p class="subtitle">Interactive dashboard for incident and arrest pattern analysis</p>

        <div class="row">
            <div class="col-2">
                <div class="card">
                    <h2 class="card-title">Social Network Graph</h2>
                    <canvas id="networkCanvas" width="800" height="500"></canvas>
                    <p class="canvas-note">Node size indicates connection count. Hover to preview connections, click to view details.</p>
                    
                    <div id="nodeDetails" class="node-details">
                        <div class="node-details-header">
                            <div class="node-details-title" id="nodeTitle">Individual #1</div>
                            <button class="close-btn" onclick="closeDetails()">âœ•</button>
                        </div>
                        <div class="details-grid">
                            <div>
                                <div class="detail-item-label">Last Arrest Date</div>
                                <div class="detail-item-value" id="arrestDate">-</div>
                            </div>
                            <div>
                                <div class="detail-item-label">Primary Charge</div>
                                <div class="detail-item-value" id="charge">-</div>
                            </div>
                            <div>
                                <div class="detail-item-label">Ward</div>
                                <div class="detail-item-value" id="ward">-</div>
                            </div>
                            <div>
                                <div class="detail-item-label">Age</div>
                                <div class="detail-item-value" id="age">-</div>
                            </div>
                            <div>
                                <div class="detail-item-label">Total Arrests</div>
                                <div class="detail-item-value" id="totalArrests">-</div>
                            </div>
                            <div>
                                <div class="detail-item-label">Known Associates</div>
                                <div class="detail-item-value" id="associates">-</div>
                            </div>
                            <div>
                                <div class="detail-item-label">Incidents Involved</div>
                                <div class="detail-item-value" id="incidents">-</div>
                            </div>
                            <div>
                                <div class="detail-item-label">Prior Offenses</div>
                                <div class="detail-item-value" id="priorOffenses">-</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="col-1">
                <div class="card">
                    <h2 class="card-title">Network Statistics</h2>
                    <div id="networkStats"></div>
                </div>
            </div>
        </div>

        <div class="row">
            <div class="col-1">
                <div class="card">
                    <h2 class="card-title">Arrests by Ward</h2>
                    <div class="chart-container">
                        <canvas id="wardChart"></canvas>
                    </div>
                </div>
            </div>
            <div class="col-1">
                <div class="card">
                    <h2 class="card-title">Monthly Activity Trends</h2>
                    <div class="chart-container">
                        <canvas id="temporalChart"></canvas>
                    </div>
                    <div class="insight-box">
                        <strong>Peak Activity:</strong> June-August shows highest incident rates, correlating with summer months.
                    </div>
                </div>
            </div>
        </div>

        <div class="card">
            <h2 class="card-title">Summary Statistics</h2>
            <div class="summary-grid" id="summaryStats"></div>
        </div>
    </div>

    <script>
        var networkData;
        var hoveredNode = null;
        var selectedNode = null;

        function generateNetworkData() {
            var nodes = [];
            var edges = [];
            var numNodes = 45;
            
            var charges = [
                'Unlawful Possession',
                'Aggravated Assault',
                'Illegal Discharge',
                'Armed Robbery',
                'Weapons Violation',
                'Attempted Murder'
            ];
            
            var wards = ['1st', '2nd', '3rd', '4th', '5th', '6th', '7th', '8th'];

            for (var i = 0; i < numNodes; i++) {
                var arrestDate = new Date(2024, Math.floor(Math.random() * 12), Math.floor(Math.random() * 28) + 1);
                var months = ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec'];
                
                nodes.push({
                    id: i,
                    x: Math.random() * 700 + 50,
                    y: Math.random() * 400 + 50,
                    connections: 0,
                    arrests: Math.floor(Math.random() * 5) + 1,
                    incidents: Math.floor(Math.random() * 8) + 1,
                    charge: charges[Math.floor(Math.random() * charges.length)],
                    ward: wards[Math.floor(Math.random() * wards.length)],
                    arrestDate: months[arrestDate.getMonth()] + ' ' + arrestDate.getDate() + ', 2024',
                    age: Math.floor(Math.random() * 30) + 18,
                    priorOffenses: Math.floor(Math.random() * 10)
                });
            }

            for (var i = 0; i < numNodes; i++) {
                var numConnections = Math.floor(Math.random() * 4) + 1;
                for (var j = 0; j < numConnections; j++) {
                    var target = Math.floor(Math.random() * numNodes);
                    var exists = false;
                    
                    for (var k = 0; k < edges.length; k++) {
                        if ((edges[k].source === i && edges[k].target === target) ||
                            (edges[k].source === target && edges[k].target === i)) {
                            exists = true;
                            break;
                        }
                    }
                    
                    if (target !== i && !exists) {
                        edges.push({ source: i, target: target });
                        nodes[i].connections++;
                        nodes[target].connections++;
                    }
                }
            }

            return { nodes: nodes, edges: edges };
        }

        function calculateNetworkStats(data) {
            var nodes = data.nodes;
            var edges = data.edges;
            var totalConnections = 0;

            for (var i = 0; i < nodes.length; i++) {
                totalConnections += nodes[i].connections;
            }
            
            var avgConnections = totalConnections / nodes.length;
            var density = (2 * edges.length) / (nodes.length * (nodes.length - 1));

            return {
                'Total Nodes': nodes.length,
                'Total Edges': edges.length,
                'Avg Connections': avgConnections.toFixed(2),
                'Longest Path': 8,
                'Network Density': (density * 100).toFixed(2) + '%',
                'Clustering': '0.34'
            };
        }

        function drawNetwork() {
            var canvas = document.getElementById('networkCanvas');
            var ctx = canvas.getContext('2d');
            var nodes = networkData.nodes;
            var edges = networkData.edges;

            ctx.fillStyle = '#0a0e1a';
            ctx.fillRect(0, 0, canvas.width, canvas.height);

            ctx.strokeStyle = '#1e3a5f';
            ctx.lineWidth = 1;
            
            for (var i = 0; i < edges.length; i++) {
                var source = nodes[edges[i].source];
                var target = nodes[edges[i].target];
                ctx.beginPath();
                ctx.moveTo(source.x, source.y);
                ctx.lineTo(target.x, target.y);
                ctx.stroke();
            }

            for (var i = 0; i < nodes.length; i++) {
                var node = nodes[i];
                var isHovered = hoveredNode === i;
                var isSelected = selectedNode === i;
                var radius = 4 + (node.connections * 1.5);
                var intensity = Math.min(node.connections * 30, 255);

                if (isSelected) {
                    ctx.fillStyle = '#f59e0b';
                } else if (isHovered) {
                    ctx.fillStyle = '#60a5fa';
                } else {
                    ctx.fillStyle = 'rgb(' + intensity + ', ' + Math.floor(intensity * 0.6) + ', ' + Math.floor(intensity * 0.3) + ')';
                }

                ctx.beginPath();
                ctx.arc(node.x, node.y, radius, 0, Math.PI * 2);
                ctx.fill();

                if (isHovered || isSelected) {
                    ctx.strokeStyle = isSelected ? '#f59e0b' : '#60a5fa';
                    ctx.lineWidth = 2;
                    
                    for (var j = 0; j < edges.length; j++) {
                        if (edges[j].source === i) {
                            var t = nodes[edges[j].target];
                            ctx.beginPath();
                            ctx.arc(t.x, t.y, 4 + (t.connections * 1.5), 0, Math.PI * 2);
                            ctx.stroke();
                        } else if (edges[j].target === i) {
                            var s = nodes[edges[j].source];
                            ctx.beginPath();
                            ctx.arc(s.x, s.y, 4 + (s.connections * 1.5), 0, Math.PI * 2);
                            ctx.stroke();
                        }
                    }
                }
            }
        }

        function handleMouseMove(e) {
            var canvas = document.getElementById('networkCanvas');
            var rect = canvas.getBoundingClientRect();
            var x = (e.clientX - rect.left) * (canvas.width / rect.width);
            var y = (e.clientY - rect.top) * (canvas.height / rect.height);
            var nodes = networkData.nodes;
            var found = null;

            for (var i = 0; i < nodes.length; i++) {
                var node = nodes[i];
                var dx = x - node.x;
                var dy = y - node.y;
                var distance = Math.sqrt(dx * dx + dy * dy);
                var radius = 4 + (node.connections * 1.5);

                if (distance < radius) {
                    found = i;
                    break;
                }
            }

            if (hoveredNode !== found) {
                hoveredNode = found;
                drawNetwork();
            }
        }

        function handleClick(e) {
            var canvas = document.getElementById('networkCanvas');
            var rect = canvas.getBoundingClientRect();
            var x = (e.clientX - rect.left) * (canvas.width / rect.width);
            var y = (e.clientY - rect.top) * (canvas.height / rect.height);
            var nodes = networkData.nodes;
            var found = null;

            for (var i = 0; i < nodes.length; i++) {
                var node = nodes[i];
                var dx = x - node.x;
                var dy = y - node.y;
                var distance = Math.sqrt(dx * dx + dy * dy);
                var radius = 4 + (node.connections * 1.5);

                if (distance < radius) {
                    found = i;
                    break;
                }
            }

            if (found !== null) {
                selectedNode = found;
                showNodeDetails(found);
                drawNetwork();
            }
        }

        function showNodeDetails(nodeIndex) {
            var node = networkData.nodes[nodeIndex];
            var detailsPanel = document.getElementById('nodeDetails');
            
            document.getElementById('nodeTitle').textContent = 'Individual #' + (nodeIndex + 1);
            document.getElementById('arrestDate').textContent = node.arrestDate;
            document.getElementById('charge').textContent = node.charge;
            document.getElementById('ward').textContent = node.ward;
            document.getElementById('age').textContent = node.age;
            document.getElementById('totalArrests').textContent = node.arrests;
            document.getElementById('associates').textContent = node.connections;
            document.getElementById('incidents').textContent = node.incidents;
            document.getElementById('priorOffenses').textContent = node.priorOffenses;
            
            detailsPanel.classList.add('active');
        }

        function closeDetails() {
            document.getElementById('nodeDetails').classList.remove('active');
            selectedNode = null;
            drawNetwork();
        }

        function init() {
            networkData = generateNetworkData();

            document.getElementById('networkCanvas').addEventListener('mousemove', handleMouseMove);
            document.getElementById('networkCanvas').addEventListener('mouseleave', function() {
                hoveredNode = null;
                drawNetwork();
            });
            document.getElementById('networkCanvas').addEventListener('click', handleClick);

            var stats = calculateNetworkStats(networkData);
            var statsContainer = document.getElementById('networkStats');
            var keys = ['Total Nodes', 'Total Edges', 'Avg Connections', 'Longest Path', 'Network Density', 'Clustering'];

            for (var i = 0; i < keys.length; i++) {
                var statItem = document.createElement('div');
                statItem.className = 'stat-item';
                statItem.innerHTML = '<div class="stat-label">' + keys[i] + '</div><div class="stat-value">' + stats[keys[i]] + '</div>';
                statsContainer.appendChild(statItem);
            }

            new Chart(document.getElementById('wardChart'), {
                type: 'bar',
                data: {
                    labels: ['1st', '2nd', '3rd', '4th', '5th', '6th', '7th', '8th'],
                    datasets: [{
                        label: 'Arrests',
                        data: [87, 134, 98, 156, 112, 89, 143, 78],
                        backgroundColor: '#3b82f6'
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: { legend: { display: false } },
                    scales: {
                        x: { grid: { color: '#1e3a5f' }, ticks: { color: '#94a3b8' } },
                        y: { grid: { color: '#1e3a5f' }, ticks: { color: '#94a3b8' } }
                    }
                }
            });

            new Chart(document.getElementById('temporalChart'), {
                type: 'line',
                data: {
                    labels: ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec'],
                    datasets: [
                        {
                            label: 'Incidents',
                            data: [45, 38, 52, 61, 73, 89, 94, 87, 76, 68, 54, 49],
                            borderColor: '#ef4444',
                            tension: 0.3
                        },
                        {
                            label: 'Arrests',
                            data: [23, 19, 27, 31, 38, 45, 48, 44, 39, 35, 28, 25],
                            borderColor: '#10b981',
                            tension: 0.3
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: { legend: { labels: { color: '#94a3b8' } } },
                    scales: {
                        x: { grid: { color: '#1e3a5f' }, ticks: { color: '#94a3b8' } },
                        y: { grid: { color: '#1e3a5f' }, ticks: { color: '#94a3b8' } }
                    }
                }
            });

            var summaryData = [
                ['Avg Incidents Before Arrest', '3.4'],
                ['Most Common Charge', 'Unlawful Possession'],
                ['Avg Time Between Incidents', '18.7 days'],
                ['Repeat Offender Rate', '42%'],
                ['Multi Person Incidents', '67%'],
                ['Average Network Size', '4.2 persons']
            ];

            var summaryContainer = document.getElementById('summaryStats');
            for (var i = 0; i < summaryData.length; i++) {
                var summaryItem = document.createElement('div');
                summaryItem.className = 'summary-item';
                summaryItem.innerHTML = '<div class="summary-label">' + summaryData[i][0].toUpperCase() + '</div><div class="summary-value">' + summaryData[i][1] + '</div>';
                summaryContainer.appendChild(summaryItem);
            }

            drawNetwork();
        }

        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', init);
        } else {
            init();
        }
    </script>
</body>
</html>
